# Profile: 2026-01-16-1614

## Configuration
- Hero: simple (always takes action 0)
- Villain: simple (always takes action 0)
- Games: 200
- Threads: 1
- skip_trivial: True
- enable_profiler: True
- Hero deck: Mountain x20, Grey Ogre x20
- Villain deck: Forest x20, Llanowar Elves x20

## Results
- **Throughput**: 329.73 games/sec
- **Steps/sec**: 16,122.16
- **Total steps**: 9,779
- **Wall time**: 0.607s
- **Avg steps/game**: 48.9

## Comparison to Previous Profile (20260116)

| Metric | Previous | Current | Change |
|--------|----------|---------|--------|
| Throughput | 271.11 games/sec | 329.73 games/sec | **+21.6%** |
| Steps/sec | 12,612 | 16,122 | **+27.8%** |
| Wall time | 0.738s | 0.607s | -17.7% |

## Time Breakdown

| Component | Time | % of Total | Calls | Per-call |
|-----------|------|------------|-------|----------|
| env_step | 0.548s | 100.0% | 9,779 | 56.1us |
| env_step/game | 0.253s | 46.2% | 9,779 | 25.9us |
| env_step/game/tick | 0.185s | 33.7% | 67,822 | 2.7us |
| env_step/game/tick/turn | 0.169s | 30.8% | 98,502 | 1.7us |
| env_step/game/tick/turn/phase | 0.153s | 27.9% | 98,502 | 1.6us |
| env_step/game/tick/turn/phase/step | 0.130s | 23.7% | 98,502 | 1.3us |
| env_step/game/tick/turn/phase/step/priority | 0.063s | 11.5% | 87,590 | 0.7us |
| env_step/observation | 0.019s | 3.4% | 9,779 | 1.9us |
| env_step/observation/populatePermanents | 0.007s | 1.2% | 9,779 | 0.7us |
| env_step/observation/populateCards | 0.003s | 0.6% | 9,779 | 0.4us |
| env_step/observation/populateTurn | 0.002s | 0.4% | 19,558 | 0.1us |
| env_step/observation/populatePlayers | 0.001s | 0.2% | 9,779 | 0.1us |

## Raw Profiler Output

```
env_step: total=0.548251s, count=9779
env_step/game: total=0.253427s, count=9779
env_step/game/tick: total=0.184916s, count=67822
env_step/game/tick/turn: total=0.169054s, count=98502
env_step/game/tick/turn/phase: total=0.153284s, count=98502
env_step/game/tick/turn/phase/step: total=0.130089s, count=98502
env_step/game/tick/turn/phase/step/priority: total=0.0628514s, count=87590
env_step/game/tick/turn/phase/step/priority/priority: total=0.0072132s, count=2669
env_step/observation: total=0.0186812s, count=9779
env_step/observation/populateCards: total=0.00349338s, count=9779
env_step/observation/populatePermanents: total=0.00661777s, count=9779
env_step/observation/populatePlayers: total=0.00107734s, count=9779
env_step/observation/populateTurn: total=0.00195697s, count=19558
```

## Behavior Stats (Hero)

| Metric | Value |
|--------|-------|
| win_rate | 1.00 |
| games_played | 200 |
| avg_game_length | 7.22 turns |
| land_play_rate | 1.00 |
| lands_played | 1,321 |
| spell_cast_rate | 1.23 |
| spells_cast | 4,656 |
| attack_rate | 1.00 |
| attacks_declared | 3,383 |
| mana_efficiency | 0.74 |

## Key Observations

1. **Significant performance improvement**: Throughput increased 21.6% from 271 to 330 games/sec.

2. **Observation overhead reduced**: Previously observation was 17.3% of env_step time, now it's only 3.4%. This suggests the lazy observation creation optimization (from diagnosis) was implemented.

3. **Tick amplification still present**: For 9,779 agent steps, there are still 67,822 game ticks (6.9x) and 98,502 turn/phase/step ticks (10.1x). The turn structure overhead remains.

4. **Turn hierarchy still dominant**: Turn/phase/step processing accounts for ~31% of total time (vs 23% before), but this is now a larger share of a smaller total because observation overhead dropped dramatically.

5. **Per-step time improved**: Average env_step time dropped from 73.4us to 56.1us (-23.5%).

## Changes Since Previous Profile

The perf branch now has changes to:
- `managym/agent/observation.cpp` - Likely lazy observation creation
- `managym/agent/observation.h` - Vector-based storage instead of maps
- `managym/flow/game.cpp` and `game.h` - Game tick modifications
